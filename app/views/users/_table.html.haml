%table.table.table-striped
  %tr
    %th.srt= sort_link @search, :last_name,  'Name'
    - if @chapter
      %th= 'Member' #.srt= sort_link @search, :member,     'Member'
    %th.srt= sort_link @search, :email,      'Email'
    - if @chapter
      %th Goblin Stamps
      %th.ln Total
      %th New Character
    - unless @chapter
      %th Dragon Stamps
    %th Characters

  - @users.each do |user|
    - if @chapter
      - characters = Character.find_all_by_user_id_and_chapter_id(user.id, @chapter.id)
      - member = Member.find_by_user_id_and_chapter_id(user.id, @chapter.id)
    - else
      - characters = user.characters
    %tr
      - if @chapter
        %td= link_to user.name, member_path(member)
        %td= best_in_place member, :member, type: :checkbox, collection: %w[No Yes]
      - else
        %td= link_to user.name, edit_user_path(user)
      %td= user.email
      - if @chapter
        %td= link_to 'Add/Remove', chapter_user_stamp_tracks_path(@chapter.id, user.id), class: 'btn'
        %td.ln= member.goblin_stamps
        %td= link_to 'New Character', new_chapter_user_character_path(@chapter.id,user.id)
      - unless @chapter
        %td.ln= user.dragon_stamps
      %td
        - characters.each do |c|
          %ul.left= link_to c.name, edit_chapter_character_path(c.chapter, c)
      